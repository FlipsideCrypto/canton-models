version: 2

models:
  - name: core__fact_transfers
    description: '{{ doc("core__fact_transfers") }}'
    tests:
      - dbt_utils.recency:
          datepart: hour
          field: effective_at
          interval: 24
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - event_id
            - output_index
    columns:
      - name: update_id
        description: '{{ doc("col_update_id") }}'
        tests:
          - not_null
      - name: migration_id
        description: '{{ doc("col_migration_id") }}'
      - name: record_time
        description: '{{ doc("col_record_time") }}'
      - name: effective_at
        description: '{{ doc("col_effective_at") }}'
        tests:
          - not_null
      - name: event_id
        description: '{{ doc("col_event_id") }}'
        tests:
          - not_null
      - name: event_index
        description: '{{ doc("col_event_index") }}'
        tests:
          - not_null
      - name: choice
        description: 'Transfer choice type (always AmuletRules_Transfer)'
        tests:
          - not_null
          - accepted_values:
              values: ['AmuletRules_Transfer']
      - name: output_index
        description: 'Index of this output within the transfer outputs array (0-based)'
        tests:
          - not_null
      - name: sender
        description: '{{ doc("col_sender") }}'
        tests:
          - not_null
      - name: provider
        description: '{{ doc("col_provider") }}'
        tests:
          - not_null
      - name: receiver
        description: 'Party receiving this output of the transfer'
        tests:
          - not_null
      - name: amount
        description: 'Amount being transferred to this receiver in this output'
        tests:
          - not_null
      - name: receiver_fee_ratio
        description: 'Fee ratio for this receiver output'
      - name: lock
        description: 'Lock details if this output creates a locked amulet'
      - name: tx_kind
        description: 'Transaction kind from transfer metadata (e.g., payment, reward)'
      - name: fact_transfer_id
        description: 'Surrogate key generated from event_id and output_index'
        tests:
          - not_null
          - unique
      - name: inserted_timestamp
        description: '{{ doc("col_inserted_timestamp") }}'
      - name: modified_timestamp
        description: '{{ doc("col_modified_timestamp") }}'
