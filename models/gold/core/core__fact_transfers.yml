version: 2

models:
  - name: core__fact_transfers
    description: '{{ doc("core__fact_transfers") }}'
    tests:
      - dbt_utils.recency:
          datepart: hour
          field: effective_at
          interval: 24
    columns:
      - name: update_id
        description: '{{ doc("col_update_id") }}'
        tests:
          - not_null
      - name: migration_id
        description: '{{ doc("col_migration_id") }}'
      - name: record_time
        description: '{{ doc("col_record_time") }}'
      - name: effective_at
        description: '{{ doc("col_effective_at") }}'
        tests:
          - not_null
      - name: event_id
        description: '{{ doc("col_event_id") }}'
        tests:
          - not_null
          - unique
      - name: event_index
        description: '{{ doc("col_event_index") }}'
        tests:
          - not_null
      - name: choice
        description: 'Transfer choice type (always AmuletRules_Transfer)'
        tests:
          - not_null
          - accepted_values:
              values: ['AmuletRules_Transfer']
      - name: acting_parties
        description: '{{ doc("col_acting_parties") }}'
      - name: sender
        description: '{{ doc("col_sender") }}'
        tests:
          - not_null
      - name: provider
        description: '{{ doc("col_provider") }}'
        tests:
          - not_null
      - name: receiver
        description: '{{ doc("col_receiver") }}'
      - name: amount
        description: 'Amount being transferred to receiver'
        tests:
          - not_null
      - name: receiver_fee_ratio
        description: 'Fee ratio for the receiver'
      - name: receiver_lock
        description: 'Lock details if the transfer creates a locked amulet'
      - name: transfer_inputs
        description: 'Array of input amulets used in the transfer'
      - name: beneficiaries
        description: 'Optional beneficiaries for the transfer'
      - name: expected_dso
        description: '{{ doc("col_expected_dso") }}'
      - name: featured_app_right
        description: 'Featured app right contract ID from context'
      - name: open_mining_round
        description: 'Open mining round contract ID from context'
      - name: issuing_mining_rounds
        description: 'Array of issuing mining rounds from context'
      - name: validator_rights
        description: 'Validator rights from context'
      - name: round_number
        description: '{{ doc("col_round_number") }}'
        tests:
          - not_null
      - name: amulet_price
        description: 'USD price of amulet at time of transfer'
      - name: input_amulet_amount
        description: 'Total input amulet amount'
      - name: sender_change_amount
        description: 'Change amount returned to sender'
      - name: sender_change_fee
        description: 'Fee charged on sender change'
      - name: holding_fees
        description: 'Holding fees charged in the transfer'
      - name: balance_changes
        description: 'Array of balance changes per party'
      - name: created_amulets
        description: 'Array of newly created amulet contracts'
      - name: sender_change_amulet
        description: 'Contract ID of the sender change amulet'
      - name: transfer_meta
        description: 'Metadata including sender and tx-kind'
      - name: contract_id
        description: '{{ doc("col_contract_id") }}'
      - name: template_id
        description: '{{ doc("col_template_id") }}'
      - name: fact_transfer_id
        description: 'Surrogate key generated from event_id'
        tests:
          - not_null
          - unique
      - name: inserted_timestamp
        description: '{{ doc("col_inserted_timestamp") }}'
      - name: modified_timestamp
        description: '{{ doc("col_modified_timestamp") }}'
